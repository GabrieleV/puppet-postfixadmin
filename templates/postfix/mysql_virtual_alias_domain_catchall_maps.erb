#
#  MANAGED BY PUPPET
#     do not edit this file manualy
#
# File: mysql_virtual_alias_domain_catchall_maps.cf
#
# handles catch-all settings of target-domain

user     = <%= @dbuser %>
password = <%= @dbpass %>
hosts    = <%= @hosts.join(' ') %>
dbname   = <%= @dbname %>

query = SELECT goto 
        FROM alias
          JOIN domain AS domain_target ON alias.domain              = domain_target.domain
          JOIN alias_domain            ON domain_target.domain      = alias_domain.target_domain
          JOIN domain AS domain_alias  ON alias_domain.alias_domain = domain_alias.domain
        WHERE domain_alias.domain   = '%d'
          AND alias.address         = CONCAT('@', alias_domain.target_domain)
          AND alias.active          = 1
          AND domain_target.active  = 1
          AND alias_domain.active   = 1
          AND domain_alias.active   = 1

# Original postfixadmin query
#query = SELECT goto
#        FROM alias,alias_domain 
#        WHERE alias_domain.alias_domain = '%d'
#          AND alias.address             = CONCAT('@', alias_domain.target_domain) 
#          AND alias.active              = 1 
#          AND alias_domain.active       = '1'
